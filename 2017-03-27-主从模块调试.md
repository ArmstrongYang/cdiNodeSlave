# 系统调试记录

## 初始程序：
主：cdiProject\MasterApp
从：cdiNodeSlave\SlaveModules\0x10-sRGB v2.0

## 单个从模块数据帧：@hiyangdong 2017-03-27 22:08:40
1. 复位后，数据收发正常，但是过一段时间出现错误
2. 主模块强制拉高进行总线恢复，依然不成功
3. 错误检查：I2C总线（SCL）拉低

## 单个从模块广播帧：@hiyangdong 2017-03-27 23:33:06
1. 能够接收到数据：0 10 10 1 1 1 10 5 0 0 0 0 0 0 8b df
2. 但是过一段时间，I2C总线依旧出现问题
3. 错误检查：I2C总线处于busy状态（SCL，SDA均被拉低）
4. 从模块完全不运行的感觉，连灯都不闪烁，而且重新下载程序又会成功一次。
5. 从模块只返回一次成功的广播帧数据
6. 从模块的串口数据发送不正常：怀疑串口引脚和SW下载引脚混合（检查后并没有，串口PA2，3）
7. RGB引脚和串口复用
8. 经过测试，硬件连接正常


## 单个从模块I2C总线恢复
1. 发生错误时，主模块的i2c状态为：
HAL_I2C_STATE_READY=HAL_I2C_GetState(&BUS_I2C)
HAL_I2C_GetError(&BUS_I2C)=0
只有在从模块重新初始化的瞬间，HAL_I2C_GetError(&BUS_I2C)=0x4或者0x20
从模块的状态为HAL_I2C_STATE_SLAVE_BUSY_RX = 0x42
2. 从模块不能一直间隔一定时间初始化i2c，初始化一次就行